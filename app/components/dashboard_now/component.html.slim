.relative
  .absolute.w-full.px-1
    .grid.grid-cols-3.gap-3.md:gap-10.mt-24.h-8.md:h-16
      .transform.rotate-90
        = render Flow::Component.new value: calculator.inverter_to_wallbox, signal: true

      div

      .transform.rotate-90
        = render Flow::Component.new value: calculator.grid_to_wallbox, signal: false

    .flex.flex-row.items-center.-mt-10.md:mt-3
      .w-1/2.transform.rotate-180
        = render Flow::Component.new value: calculator.inverter_to_house, signal: true

      - case calculator.feeding?
        - when true
          .w-1/2.transform.rotate-180
            = render Flow::Component.new value: calculator.house_to_grid, signal: true
        - when false
          .w-1/2
            = render Flow::Component.new value: calculator.grid_to_house, signal: false

    .grid.grid-cols-3.gap-3.md:gap-10
      .transform.-rotate-90
        = render Flow::Component.new value: calculator.inverter_to_battery, signal: true

      .transform.rotate-90
        = render Flow::Component.new value: calculator.battery_to_house, signal: true

      .transform.-rotate-90
        = render Flow::Component.new value: calculator.grid_to_battery, signal: false

  .grid.gap-3.md:gap-y-10.text-center.text-white
    = render Card::Component.new field: 'wallbox_charge_power', value: calculator.wallbox_charge_power, signal: calculator.wallbox_charge_power&.positive? ? false : nil do |component|
      .flex.flex-row.justify-around.items-center
        .w-1/3.pr-10
          = tag.div class: 'text-2xl md:text-4xl' do
            = Number::Component.new(value: calculator.wallbox_charge_power).to_kw

        .w-1/3
          = component.icon
          h1.text-xs.md:text-sm.uppercase.md:tracking-wider.hidden.md:block
            = component.title

        .w-1/3

    .grid.grid-cols-3.gap-3.md:gap-10
      = render Card::Component.new field: 'inverter_power', value: calculator.inverter_power, signal: calculator.producing? || nil, klasses: 'flex flex-col justify-center' do |component|
        = component.icon

        h1.mt-2.text-xs.md:text-sm.uppercase.md:tracking-wider.hidden.md:block
          = component.title

        = tag.div class: 'mt-5 text-2xl md:text-4xl' do
          = Number::Component.new(value: calculator.inverter_power).to_kw

        h1.mt-2.text-xs.md:text-base
          br

      .grid.gap-3
        = render Card::Component.new field: 'house_power', value: calculator.house_power, signal: calculator.autarky, klasses: 'flex flex-col justify-center' do |component|
          = component.icon

          h1.mt-2.text-xs.md:text-sm.uppercase.md:tracking-wider.hidden.md:block
            = component.title

          = tag.div class: 'mt-5 text-2xl md:text-4xl' do
            = Number::Component.new(value: calculator.house_power).to_kw

          h1.mt-2.text-xs.md:text-base
            =t 'calculator.autarky'
            =< Number::Component.new(value: calculator.autarky).to_percent(max_precision: 0, klass: 'text-current')

          - component.with :tippy do
            = render AutarkyDetails::Component.new(calculator: calculator)

      = render Card::Component.new field: calculator.grid_power_field, value: calculator.grid_power, signal: calculator.feeding?, klasses: 'flex flex-col justify-center' do |component|
        = component.icon

        h1.mt-2.text-xs.md:text-sm.uppercase.md:tracking-wider.hidden.md:block
          =t 'calculator.grid_power'

        = tag.div class: 'mt-5 text-2xl md:text-4xl' do
          = Number::Component.new(value: calculator.grid_power).to_kw

        h1.mt-2.text-xs.md:text-base
          br

    = render Card::Component.new field: calculator.bat_power_field, value: calculator.bat_power, signal: !calculator.bat_empty? || nil do
      .flex.flex-row.justify-around.items-center
        .w-1/3.pr-10
          = tag.div class: 'text-2xl md:text-4xl' do
            = Number::Component.new(value: calculator.bat_power).to_kw

        .w-1/3
          - case calculator.bat_fuel_charge
            - when 0..9
              i.fas.fa-battery-empty.fa-2x
            - when 10..40
              i.fas.fa-battery-quarter.fa-2x
            - when 41..60
              i.fas.fa-battery-half.fa-2x
            - when 61..94
              i.fas.fa-battery-three-quarters.fa-2x
            - when 95..100
              i.fas.fa-battery-full.fa-2x

          h1.text-xs.md:text-sm.uppercase.md:tracking-wider.hidden.md:block
            =t 'calculator.bat_power'

        .w-1/3.text-2xl.pl-10
          = Number::Component.new(value: calculator.bat_fuel_charge).to_percent(klass: 'text-current')
